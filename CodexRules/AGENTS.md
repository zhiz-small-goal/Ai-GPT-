## 个人偏好

- 默认使用简体中文回答，技术术语可以用英文（例如 signal/slot、event filter）。
- 回答时不要使用“复杂”“困难”等主观评价词。
- 默认假定用户是正在进阶 C++17 / Qt6 的工程师，环境以 VS Code / CMake / Qt Creator / Visual Studio 为主。

## 通用工作方式

- 对已有项目：先阅读仓库里的 README.md、AI_README.md、开发文档，再改代码。
- 务必保持现有功能行为不变，避免无关的大改或“顺手重构”。
- 提交改动前，要给出清晰的改动列表（文件级 / 函数级 / 逻辑点）。
- 项目全程都采用最稳定、当前被验证为可靠的最佳实践，保证正确性。
- 当需要在多种方案中取舍时，优先选择：
  - 官方文档推荐的方式；
  - 业界成熟实现中反复出现的模式；
  - 更易维护、更易调试的方案。
  - 定制细致的计划，一步步稳定进行开发，先把计划给用户确认。


## 代码风格

- C++：优先使用 C++17 标准库，避免非必要的宏魔法。
- Qt：优先使用 Qt6 Widgets + WebEngine 的官方推荐用法。
- 路径：尽量使用相对路径，避免写死绝对路径。
- 弹窗：对于不重要的弹窗，采用约 0.5 秒自动消失的提示风格（非模态，不打断用户主流程）。

---

## 功能新增 / Bug 修复工作流与变更记录约定

当用户提出“新增功能 / 调整行为 / 修复 Bug”类任务时，请默认进入统一工作流，并在必要时生成一条**变更记录**并插入到指定md文件中，方便日后查阅和喂给其他模型。

### 1. 触发条件

符合以下任意情况时，视为需要标准工作流的“有效改动”：

- 改动会影响程序行为（例如：窗口锁定 / 点穿策略、输入响应、渲染逻辑、状态持久化等）。
- 改动会影响对外接口或关键内部协议（例如：函数签名、事件分发、配置格式）。
- 改动的思路、取舍本身有决策意义，未来可能需要参考。

以下情况可以按“轻量模式”处理（见后文“轻量改动时的简化规则”一节）：

- 纯命名优化、注释补充、不改变语义的格式整理。
- 非关键 UI 微调（如微小 padding 调整、label 文案优化等）。

### 2. 标准工作步骤

对于“有效改动”，请按以下步骤工作并在回答中体现：

1. **理解与总结**
   - 在修改代码前，先用 3–5 行话总结你理解的：
     - 问题或需求的现象；
     - 可能的根因；
     - 预计受影响的模块 / 文件。
   - 如有歧义或多种解释，在总结中直接说明假设。

2. **方案与修改**
   - 只修改与本次需求 / 问题直接相关的代码，避免无关重构。
   - 明确说明是否有“行为改变”，以及这些改变是否是用户明确要求的。
   - 对每个文件的修改，用“文件 → 函数 / 类 → 修改点”的层级列出，例如：
     - `src/app/MainWindow.cpp`
       - `openMarkdownFileFromDialog()`
         - 调整文件对话框初始目录使用 `m_lastOpenDir`。
       - `handleOpenMarkdownUrl(const QUrl &url)`
         - 简化为仅处理内部 `.md` 链接，基于当前文件目录解析目标路径。

3. **测试建议**
   - 给出可操作的“测试清单”，用勾选框列出：
     - [ ] 启动场景
     - [ ] 常规使用场景
     - [ ] 边界 / 异常场景
   - 能用现有工具 / 命令行快速验证的，尽量写成具体命令或操作步骤。

### 3. 变更记录生成规则（功能新增与 Bug 修复通用）

当本次改动符合“有效改动”条件时，请在代码修改说明之后，额外生成一条**变更记录**，内容结构化，并追加到项目日志文件[STAGE_PLAN.md]中。

约定如下：

1. **编号管理**
   - 标题前使用 `[编号]` 形式，例如 `[006]`。
   - 编号由你来最终决定顺序，按照文档序号自动推断排序下一个，例如：

2. **日期与标题**
   - 日期使用当前日期，格式为 `YYYY-MM-DD`。
   - 标题应简要概括本次改动的核心，例如：
     - `统一 Markdown 内部链接与对话框打开逻辑`
     - `调整锁定状态下的右键翻页与点穿行为`

3. **变更记录模板（统一结构）**

生成记录时，请使用如下模板（其中内容由你根据本次任务自动填充；“阶段”等字段如项目未显式定义，可留空或不写）：

```markdown
### [编号占位：例如 006] YYYY-MM-DD 标题（例如：统一 Markdown 内部链接与对话框打开逻辑）

日期：YYYY-MM-DD  
状态：进行中 / 已完成 / 待确认  

**变更类型：**  
- 功能新增 / 行为调整 / Bug 修复（选择合适项）

**涉及阶段：**  
- 阶段 X：xxxx  
- （如项目没有阶段划分，可省略此小节）

**目标：**  
- 用 1–3 条列出本次改动希望达成的效果

**触发原因：**  
- 简要描述触发本次修改的具体问题或需求（例如用户反馈、发现的 Bug 现象、性能 / 可维护性考虑等）

**涉及文件：**  
- 列出本次改动涉及的主要文件路径（例如：`src/app/MainWindow.cpp`）

**改动概览：**  
- 按“文件 -> 函数 / 点”的结构列出关键改动
- 必要时附带关键逻辑的简要解释（例如：链接解析策略、命中测试逻辑等）

**关键点说明：**  
- 说明与行为、架构相关的关键约束和注意事项
- 特别标出“以后改动时必须保持”的约束（例如：默认锁定状态下必须点穿、Ctrl 为临时解锁等）

**测试验证：**  
- [ ] 列出建议我手动执行的测试步骤  
- 如有自动化测试，也在这里说明触发方式或命令

**后续 TODO：**  
- [ ] 可以在此基础上继续做的优化 / 扩展  
- 若没有后续工作，写明“无”
```


## 轻量改动时的简化规则

当改动属于“轻量改动”（命名调整、注释优化、不影响行为的小范围重构等）时：

- 可以只追加一句话或一个简短小节，说明：
  - 改了哪些文件；
  - 目的是什么（例如“提升可读性”“统一命名风格”）；
  - 明确写出“无行为变化 / 无需专门测试”。
- 不强制使用完整变更记录模板，以免噪音过多。

---

## 项目级别 AGENTS.md 的配合方式（说明性条目）

- 全局 AGENTS.md 只描述通用偏好与工作流，不绑定具体项目。
- 具体项目（例如 TransparentMdReader）可以在仓库根目录再创建一个 `AGENTS.md`，专门写：
  - 项目背景、技术栈、模块划分；
  - 锁定 / 点穿、右键翻页、Ctrl 解锁等行为约定；
  - 日志文件的具体路径（例如 `docs/dev_logs/transparent_reader_log.md`）；
  - 项目特有的“阶段”定义和编号规则。
- 当项目级 AGENTS 与全局 AGENTS 有差异时，请优先遵守项目级 AGENTS 中更具体的约定。
